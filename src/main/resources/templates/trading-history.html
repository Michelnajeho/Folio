<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
    <link rel="stylesheet" th:href="@{/css/trading-history.css}"/>
</head>
<body>
<div layout:fragment="content">

    <div class="th-header">
        <div class="th-header-top">
            <div>
                <h1>Trade History</h1>
                <p>트레이딩 기록을 확인하고 관리하세요.</p>
            </div>
            <!-- Account Selector -->
            <div class="th-account-selector" th:if="${#lists.size(accounts) > 0}">
                <select class="th-select th-account-select" id="accountSelect">
                    <option value="">Select Account</option>
                    <option th:each="acc : ${accounts}"
                            th:value="${acc.id}"
                            th:text="${acc.accountName + ' (' + acc.currency + ')'}"
                            th:selected="${selectedAccount != null and selectedAccount.id == acc.id}">
                    </option>
                </select>
            </div>
        </div>

        <!-- Balance Card: only when account selected -->
        <div class="th-balance-card" th:if="${selectedAccount != null}">
            <span class="th-balance-label" th:text="${selectedAccount.accountName}">Account</span>
            <span class="th-balance-value"
                  th:text="${selectedAccount.currency + ' ' + #numbers.formatDecimal(selectedAccount.balance, 1, 'COMMA', 2, 'POINT')}">$10,000.00</span>
        </div>
    </div>

    <!-- Stat Cards: when account selected -->
    <div class="th-stat-grid" th:if="${selectedAccount != null}">
        <!-- Row 1 -->
        <div class="th-stat-card">
            <div class="th-stat-label">Total Trades</div>
            <div class="th-stat-value">47</div>
        </div>
        <div class="th-stat-card">
            <div class="th-stat-label">Win Rate</div>
            <div class="th-stat-value positive">63.8%</div>
        </div>
        <div class="th-stat-card">
            <div class="th-stat-label">Profit Factor</div>
            <div class="th-stat-value positive">1.82</div>
        </div>
        <div class="th-stat-card">
            <div class="th-stat-label">Avg P&amp;L</div>
            <div class="th-stat-value positive">+$128.40</div>
        </div>
        <!-- Row 2 -->
        <div class="th-stat-card">
            <div class="th-stat-label">Best Trade</div>
            <div class="th-stat-value positive">+$2,890</div>
        </div>
        <div class="th-stat-card">
            <div class="th-stat-label">Worst Trade</div>
            <div class="th-stat-value negative">-$680</div>
        </div>
        <div class="th-stat-card">
            <div class="th-stat-label">Streak</div>
            <div class="th-stat-value positive">W3</div>
        </div>
        <div class="th-stat-card">
            <div class="th-stat-label">This Month P&amp;L</div>
            <div class="th-stat-value positive">+$3,420</div>
        </div>
    </div>

    <!-- When account selected -->
    <th:block th:if="${selectedAccount != null}">
        <!-- Toolbar -->
        <div class="th-toolbar">
            <div class="th-toolbar-left">
                <select class="th-select">
                    <option value="">All Types</option>
                    <option value="stock">Stock</option>
                    <option value="crypto">Crypto</option>
                    <option value="futures">Futures</option>
                </select>
                <select class="th-select">
                    <option value="">All Positions</option>
                    <option value="long">LONG</option>
                    <option value="short">SHORT</option>
                </select>
            </div>
            <div class="th-toolbar-right">
                <button class="th-btn-add" type="button">+ New Trade</button>
            </div>
        </div>

        <!-- Data Table -->
        <div class="th-table-wrap">
            <table class="th-table">
                <thead>
                <tr>
                    <th>Date</th>
                    <th>Type</th>
                    <th>Ticker</th>
                    <th>Position</th>
                    <th>P&amp;L</th>
                    <th>Memo</th>
                </tr>
                </thead>
                <tbody>
                <!-- Trading records will be rendered here in the future -->
                </tbody>
            </table>
        </div>

        <!-- Empty state for no trades yet -->
        <div class="th-empty">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"/>
                <rect x="9" y="3" width="6" height="4" rx="1"/>
                <line x1="9" y1="12" x2="15" y2="12"/>
                <line x1="9" y1="16" x2="13" y2="16"/>
            </svg>
            <p>아직 기록된 거래가 없습니다.</p>
            <p class="th-empty-sub">+ New Trade 버튼으로 거래를 기록해보세요.</p>
        </div>
    </th:block>

    <!-- When no account selected -->
    <th:block th:if="${selectedAccount == null}">
        <div class="th-empty">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M3 7h18M3 12h18M3 17h18"/>
            </svg>
            <p th:if="${#lists.size(accounts) > 0}">계좌를 선택하면 트레이딩 기록을 확인할 수 있습니다.</p>
            <p th:if="${#lists.size(accounts) == 0}">아직 등록된 계좌가 없습니다.</p>
            <p class="th-empty-sub" th:if="${#lists.size(accounts) == 0}">
                <a th:href="@{/accounts}" class="th-empty-link">Accounts</a> 메뉴에서 계좌를 등록하세요.
            </p>
        </div>
    </th:block>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var sel = document.getElementById('accountSelect');
            if (sel) {
                sel.addEventListener('change', function () {
                    if (this.value) {
                        window.location.href = '/trading-history?accountId=' + this.value;
                    } else {
                        window.location.href = '/trading-history';
                    }
                });
            }
        });
    </script>

</div>
</body>
</html>
