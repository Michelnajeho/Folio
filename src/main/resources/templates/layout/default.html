<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title layout:title-pattern="$CONTENT_TITLE - Folio">Folio</title>
    <link rel="stylesheet" as="style" crossorigin
          href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css"/>
    <link rel="stylesheet" th:href="@{/css/common.css}"/>
    <script th:src="@{/js/theme.js}"></script>
</head>
<body>

<!-- Page entry overlay (smooth transition from login intro) -->
<div class="page-entry-overlay" id="pageEntryOverlay"></div>

<div th:replace="~{fragments/header :: header}"></div>

<div class="app-body">
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>
    <div th:replace="~{fragments/sidebar :: sidebar}"></div>

    <main class="app-content">
        <div layout:fragment="content"></div>
    </main>
</div>

<script>
    function toggleSidebar() {
        var sidebar = document.querySelector('.sidebar');
        var overlay = document.getElementById('sidebarOverlay');
        var isOpen = sidebar.classList.contains('open');
        if (isOpen) {
            closeSidebar();
        } else {
            sidebar.classList.add('open');
            overlay.classList.add('active');
            overlay.style.display = 'block';
        }
    }

    function closeSidebar() {
        var sidebar = document.querySelector('.sidebar');
        var overlay = document.getElementById('sidebarOverlay');
        sidebar.classList.remove('open');
        overlay.classList.remove('active');
        setTimeout(function () { overlay.style.display = 'none'; }, 300);
    }

    /* Sidebar collapse toggle */
    function toggleSidebarCollapse() {
        var sidebar = document.querySelector('.sidebar');
        var isCollapsed = sidebar.classList.toggle('collapsed');
        localStorage.setItem('sidebar-collapsed', isCollapsed ? 'true' : 'false');
    }

    /* Restore sidebar state */
    (function () {
        if (localStorage.getItem('sidebar-collapsed') === 'true') {
            var sidebar = document.querySelector('.sidebar');
            if (sidebar) sidebar.classList.add('collapsed');
        }
    })();

    /* Page entry fade-in */
    (function () {
        var overlay = document.getElementById('pageEntryOverlay');
        if (!overlay) return;
        requestAnimationFrame(function () {
            overlay.classList.add('fade-out');
            setTimeout(function () {
                overlay.style.display = 'none';
            }, 600);
        });
    })();
</script>

</body>
</html>
